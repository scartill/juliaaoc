include("intcode.jl")

function testsimple(code, ans, input = [])
    println(run(code, input=input) == ans)
end

function testlastout(code, ans, input=[])
    output = []
    run(code, input=input, output=output) 
    println(output[end] == ans)
end

testsimple("1,9,10,3,2,3,11,0,99,30,40,50", 3500)
testsimple("1,0,0,0,99", 2)
testsimple("1,1,1,4,99,5,6,0,99", 30)

testsimple("3,0,4,5,99,77", 66, [66])
testlastout("3,0,4,5,99,77", 77, [66])

println(fetch(1002) == (2, [false, true, false]))

testsimple("1101,100,-1,4,0", 1101)

testlastout("3,9,8,9,10,9,4,9,99,-1,8", 1, [8])
testlastout("3,9,8,9,10,9,4,9,99,-1,8", 0, [6])
testlastout("3,9,7,9,10,9,4,9,99,-1,8", 1, [7])
testlastout("3,9,7,9,10,9,4,9,99,-1,8", 0, [9])

testlastout("3,3,1108,-1,8,3,4,3,99", 1, [8])
testlastout("3,3,1108,-1,8,3,4,3,99", 0, [6])
testlastout("3,3,1107,-1,8,3,4,3,99", 1, [7])
testlastout("3,3,1107,-1,8,3,4,3,99", 0, [9])

testlastout(
    "3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,
    1106,0,36,98,0,0,1002,21,125,20,4,20,1105,1,46,104,
    999,1105,1,46,1101,1000,1,20,4,20,1105,1,46,98,99",
    999, [6])
testlastout(
    "3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,
    1106,0,36,98,0,0,1002,21,125,20,4,20,1105,1,46,104,
    999,1105,1,46,1101,1000,1,20,4,20,1105,1,46,98,99",
    1000, [8])
testlastout(
    "3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,
    1106,0,36,98,0,0,1002,21,125,20,4,20,1105,1,46,104,
    999,1105,1,46,1101,1000,1,20,4,20,1105,1,46,98,99",
    1001, [15])